
# Module 4 Assignment: MAC Layer and IEEE 802.11 Concepts

---

## 1. Significance of MAC Layer and its Position in the OSI Model

The **MAC (Medium Access Control)** layer is a sublayer of the **Data Link Layer** in the **OSI Model (Layer 2)**.

### Significance:
- **Media Access:** 
    - Controls access to the physical transmission medium in a shared environment.
- **Frame Management:** 
    - Responsible for frame formatting, addressing, and error detection.
- **Coordination:** 
    - Coordinates how devices on a wireless network gain access to the medium and transmit data.
- **Security:** 
    - Implements features like encryption and authentication.

---

## 2. 802.11 MAC Header Frame Format

### General MAC Frame Format:

| Field Name        | Size   | Description                                                |
|-------------------|--------|------------------------------------------------------------|
| Frame Control     | 2 bytes| Frame type, subtype, and control flags                    |
| Duration/ID       | 2 bytes| Duration of the frame or association ID                   |
| Address 1         | 6 bytes| Usually the receiver address                              |
| Address 2         | 6 bytes| Usually the transmitter address                           |
| Address 3         | 6 bytes| BSSID or source/destination address                       |
| Sequence Control  | 2 bytes| Sequence number and fragment number                       |
| Address 4 (optional)| 6 bytes| Used in WDS (Wireless Distribution System)            |
| Frame Body        | Variable| Actual data (MSDU, management info, etc.)               |
| FCS               | 4 bytes| Frame Check Sequence (CRC for error detection)           |

### Purpose of Fields:
- **Frame Control:** Defines the type of frame (data, control, management).
- **Duration/ID:** Helps in setting NAV (Network Allocation Vector).
- **Addresses:** Identifies sender, receiver, and AP.
- **Sequence Control:** Ensures correct order and reassembly.
- **FCS:** Ensures data integrity.

---

## 3. MAC Layer Functionalities

### Management Plane:
- Beacon transmission
- Association & disassociation
- Authentication & deauthentication
- Scanning (active/passive)
- Probe request/response

### Control Plane:
- RTS/CTS (Request/Clear to Send)
- ACK (Acknowledgment)
- Power Save Poll (PS-Poll)

### Data Plane:
- Data frame handling
- Fragmentation & reassembly
- QoS support
- Encryption (WPA2/WPA3)

---

## 4. Scanning Process and Types

### Purpose:
Discover available networks (APs).

### Types:

#### Passive Scanning:
- STA listens for **beacon frames**.
- Energy efficient but slower.

#### Active Scanning:
- STA sends **probe request**.
- AP responds with **probe response**.
- Faster but more power-intensive.

---

## 5. Client Association Process

1. **Scanning:** Find available APs.
2. **Authentication:**
   - STA sends authentication request.
   - AP sends authentication response.
3. **Association:**
   - STA sends association request.
   - AP responds with association response.
4. **Connection Established:** Ready for data transmission.

---

## 6. EAPOL 4-Way Handshake and Key Derivation (Simplified)

### Purpose:
The **EAPOL 4-Way Handshake** is used in **Wi-Fi security (WPA2/WPA3)** to:
- Establish a **secure connection** between a client (STA) and an Access Point (AP).
- **Generate and exchange encryption keys** safely.
- Ensure both STA and AP use the same key for encrypted communication.

### Important Terms:

- **PMK (Pairwise Master Key):**
  - A master key created during the authentication phase.
  - Derived from:
    - **PSK** (Pre-Shared Key, e.g., your Wi-Fi password) — in WPA2-Personal.
    - Or from **EAP-based authentication** — in WPA2-Enterprise.
  - Known only to the STA and AP.

- **Nonce (Number used once):**
  - A **random value** used to ensure uniqueness in the encryption key generation process.
  - **ANonce** = Nonce generated by the AP.
  - **SNonce** = Nonce generated by the STA.

- **PTK (Pairwise Transient Key):**
  - A temporary key used to encrypt unicast (one-to-one) traffic.
  - Derived from: `PMK + ANonce + SNonce + MAC addresses of STA & AP`.

- **GTK (Group Temporal Key):**
  - Used to encrypt **multicast and broadcast** traffic (e.g., messages sent to all devices).
  - Sent securely from AP to STA.

### 4-Way Handshake Steps:

#### Message 1 (AP → STA)
- AP sends **ANonce** (its random number) to the STA.
- STA now has all inputs to generate the PTK (it has PMK, its own SNonce, and the received ANonce).

#### Message 2 (STA → AP)
- STA generates **PTK** using PMK, ANonce, SNonce, and MAC addresses.
- STA sends its **SNonce** and a **MIC (Message Integrity Code)** to prove it knows the PMK.

#### Message 3 (AP → STA)
- AP also calculates PTK and validates MIC.
- If successful, it sends:
  - **GTK** (encrypted with PTK)
  - **Install instructions** to use PTK.
- STA now has both PTK and GTK.

#### Message 4 (STA → AP)
- STA confirms everything is installed.
- The secure session is now ready.

---

## 7. Power Saving Schemes in MAC Layer

### Types:

#### Legacy PSM:

- The **STA (client device)** goes into **sleep mode** to save power.
- It wakes up **periodically** to listen for a **Traffic Indication Map (TIM)** beacon from the AP.
- If the TIM indicates buffered data for the STA, it sends a **PS-Poll** frame to retrieve the data.
- Higher **latency**, especially for real-time applications (e.g., voice/video calls).
- Not ideal for modern, interactive use cases.

#### U-APSD (Unscheduled Automatic Power Save Delivery):

- The STA doesn't need to wait for a TIM beacon.
- It sends a **trigger frame**, and the AP sends all queued packets in a burst.
- Better suited for **VoIP** or **streaming**, where low latency is needed.
- There is **no fixed time schedule** to receive data — the client triggers it anytime.
- Lower latency

#### Target Wake Time (TWT):

**Target Wake Time (TWT)** is a **power-saving feature** introduced in the
**IEEE 802.11ax (Wi-Fi 6)** standard.

TWT allows client devices (STAs) and the Access Point (AP) to **negotiate
specific times** for the STA to wake up and exchange data — reducing
unnecessary wake-ups and extending battery life.

- The **AP and STA agree** on a **TWT schedule**.
- The STA sleeps and **wakes up only at the scheduled TWT**.
- During TWT, the STA **transmits or receives** data.
- After the transmission, the STA **goes back to sleep**.

---

## 8. Medium Access Control Methodologies

The **Medium Access Control (MAC)** layer is responsible for controlling how data is transmitted over a shared wireless medium. The most common access methodologies in Wi-Fi networks are **CSMA/CA**, **DIFS/SIFS**, and **RTS/CTS**. These ensure fair and efficient communication between devices while avoiding collisions and optimizing channel usage.

### Techniques:

### 1. CSMA/CA (Carrier Sense Multiple Access with Collision Avoidance)

**CSMA/CA** is the fundamental **access method** used by Wi-Fi devices to share the wireless medium.

#### Key Features:
- **Listen before transmitting**: A device must first check if the medium is idle before attempting to send data.
- **Collision Avoidance**: If the channel is busy, the device will wait for a random period before attempting to transmit again (called **backoff**).

#### How CSMA/CA Works:

1. **Carrier Sensing**:
   - The device listens to the channel to see if it’s idle or busy (whether other devices are transmitting).
   
2. **Backoff Procedure**:
   - If the channel is busy, the device waits for a random amount of time (determined by a backoff counter). The counter resets every time the channel is busy.

3. **Transmission**:
   - If the channel is clear for a set period, the device starts transmitting the frame.
   
4. **Collision Avoidance**:
   - By waiting for a random backoff time, CSMA/CA reduces the likelihood that two devices will transmit simultaneously, thus reducing collisions.

#### Limitations:
- **Hidden Node Problem**: If two devices are outside each other’s range but can hear the AP, they may cause a collision when they transmit at the same time.
- **Inefficiency**: Devices that are far from each other or the AP may need to wait for long periods before they can transmit.

### 2. DIFS/SIFS (Distributed Interframe Space / Short Interframe Space)

**DIFS** and **SIFS** are **timing parameters** used in Wi-Fi to determine when devices can access the medium after the completion of the previous transmission.

#### DIFS (Distributed Interframe Space)
- **Used by STAs** (client devices) to wait before they can start their transmission after the **medium has been idle**.
- **Longer delay** compared to SIFS, ensuring devices don't transmit too quickly and thus avoid collision with the AP.

#### SIFS (Short Interframe Space)
- **Used by the AP** (Access Point) and **stations during data exchange** like sending an acknowledgment (ACK) frame after receiving data.
- **Shorter delay** to prioritize **immediate responses**.

#### Usage:
- **DIFS** is used for **regular data transmissions** and typically occurs after the channel has been idle.
- **SIFS** is used for **high-priority frames** (like ACKs) and ensures that these frames are transmitted without unnecessary delay.

### 3. RTS/CTS (Request to Send / Clear to Send)

**RTS/CTS** is a **mechanism** used to avoid the **hidden node problem** and reduce collisions in situations where large data frames are being sent.

#### Hidden Node Problem:
- In a wireless network, **hidden nodes** are devices that cannot hear each
other but can hear the same AP. If these devices transmit simultaneously, their
signals may collide at the AP, causing a disruption.

#### How RTS/CTS Works:

1. **RTS (Request to Send)**:
   - The device wanting to transmit sends an **RTS frame** to the AP, requesting permission to send data. The RTS includes information like the size of the frame it plans to send.
   
2. **CTS (Clear to Send)**:
   - The AP responds with a **CTS frame** to the requesting device, granting
   permission to send the data. The CTS also notifies other devices in the
   vicinity that the channel will be busy for a while.

3. **Data Transmission**:
   - Once the device receives the CTS, it transmits the data frame.
   
4. **ACK**:
   - After receiving the data, the AP or destination device sends an **ACK** to confirm successful reception.

#### Downsides of RTS/CTS:
- **Overhead**: There is some overhead involved because RTS and CTS frames
themselves take time and bandwidth. This is typically only effective in
networks with **high traffic** or **large frame sizes**.

---

## 9. Block ACK Mechanism

The **Block ACK** (Block Acknowledgment) mechanism is an advanced feature
introduced in Wi-Fi 802.11n and further improved in 802.11ac/ax standards. It
allows the **acknowledgment of multiple frames** with a single acknowledgment
frame, improving overall efficiency and throughput in wireless communication.

### How Block ACK Works:

1. **Frame Transmission**:
   - A device (usually the AP or STA) sends a sequence of data frames to a
   recipient device.
   
2. **Block ACK Request (BAR)**:
   - The transmitting device sends a **Block ACK Request (BAR)** frame to the
   receiver, indicating the start of a block of frames that will be
   transmitted.
   
3. **Block ACK**:
   - The receiver responds with a **Block ACK** frame that acknowledges the
   successful reception of multiple frames in the block. The Block ACK includes
   a bitmap of the frames that were successfully received and acknowledged.

4. **Bitmap**:
   - The bitmap in the Block ACK frame marks the received frames (with a "1"
   for successfully received and "0" for lost). The receiving device can
   acknowledge multiple frames (up to 64 frames in a single block) with a
   single Block ACK.

5. **Error Handling**:
   - If some frames in the block were not received correctly (due to
   interference or signal loss), the sender can resend only the missing frames
   based on the feedback from the Block ACK.

### Advantages:
- Reduced overhead.
- Increased throughput.
- Efficient for high-throughput (802.11n/ac/ax).

---

## 10. A-MSDU, A-MPDU, and A-MSDU in A-MPDU

**MSDU** - MAC Service Data
**MPDU** - MAC Protocol Data Unit

### A-MSDU:
- Aggregates multiple MSDUs in a single MPDU.
- Lower overhead, less resilient to loss.

### A-MPDU:
- Aggregates multiple MPDUs in one transmission.
- Each has its own CRC.

### A-MSDU in A-MPDU:

- Nested aggregation.
- Combines benefits of A-MSDU (efficiency) and A-MPDU (resilience).
- Each **MPDU contains an A-MSDU** (i.e., multiple MSDUs).
- Multiple such **MPDUs (with A-MSDUs)** are bundled into a single **A-MPDU** transmission.

---
